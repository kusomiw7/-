<!DOCTYPE html>
<html lang="zh-Hant">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ç¨‹å¼ç¢¼ç‰‡æ®µå–ä»£å·¥å…·</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       /* Custom styles for better code display and mobile view */
       body {
           font-family: 'Inter', sans-serif;
           background-color: #f7f9fc;
           min-height: 100vh;
       }
       .code-area {
           /* Using pre-wrap to allow wrapping of long lines while preserving spaces */
           white-space: pre-wrap;
           word-wrap: break-word;
           padding: 1rem;
           min-height: 150px;
           max-height: 300px; /* Limit height for scrollable area */
           overflow-y: auto;
           border: 1px solid #e2e8f0;
           border-radius: 0.5rem;
           background-color: #ffffff;
           font-family: Consolas, "Courier New", monospace;
           font-size: 0.875rem;
           line-height: 1.4;
       }
       /* Style for the highlighted match */
       .highlight {
           background-color: #fca5a5; /* Red-300 */
           color: #1f2937; /* Dark text */
           padding: 2px 4px;
           border-radius: 4px;
           display: inline-block;
       }
       /* Ad Slot Styling */
       .ad-slot {
           display: flex;
           align-items: center;
           justify-content: center;
           background-color: #e5e7eb; /* Gray-200 */
           color: #6b7280; /* Gray-500 */
           font-weight: 600;
           border: 1px dashed #9ca3af; /* Gray-400 */
           text-align: center;
           border-radius: 0.5rem;
           margin: 0.5rem;
           min-width: 100px; /* For side ads */
       }
       /* Specific dimensions for better layout */
       .ad-banner { height: 90px; } /* Horizontal banner */
       .ad-skyscraper { height: 250px; } /* Vertical skyscraper style */
   </style>
</head>
<body class="p-4 md:p-8">

   <!-- å»£å‘Šä½ 1: é ‚éƒ¨æ©«å¹… (Top Banner) -->
   <!-- å¯¦éš›éƒ¨ç½²æ™‚ï¼Œè«‹å°‡æ­¤ div å…§çš„å…§å®¹æ›¿æ›ç‚ºæ‚¨çš„å»£å‘Šç¨‹å¼ç¢¼ -->
   <div id="ad-top-banner" class="ad-slot ad-banner max-w-7xl mx-auto">
       å»£å‘Šä½ 1 (728x90) - å¯æ›¿æ›
   </div>

   <!-- ä¸»è¦ä½ˆå±€ï¼šå·¦å³å»£å‘Šä½èˆ‡ä¸­å¤®æ‡‰ç”¨ç¨‹å¼ -->
   <div class="flex flex-col lg:flex-row justify-center max-w-7xl mx-auto">

       <!-- å»£å‘Šä½ 2 & 3: å·¦å´å †ç–Š (Left Stack) -->
       <!-- å¯¦éš›éƒ¨ç½²æ™‚ï¼Œè«‹å°‡æ­¤ div å…§çš„å…§å®¹æ›¿æ›ç‚ºæ‚¨çš„å»£å‘Šç¨‹å¼ç¢¼ -->
       <div class="flex lg:flex-col justify-center lg:space-y-4 space-x-4 lg:space-x-0 order-2 lg:order-1 lg:w-[150px] mb-4 lg:mb-0">
           <div id="ad-left-1" class="ad-slot ad-skyscraper flex-1 lg:flex-none w-full">å»£å‘Šä½ 2 (120x250)</div>
           <div id="ad-left-2" class="ad-slot ad-skyscraper flex-1 lg:flex-none w-full">å»£å‘Šä½ 3 (120x250)</div>
       </div>

       <!-- ä¸­å¤®æ‡‰ç”¨ç¨‹å¼å…§å®¹ -->
       <div id="app" class="max-w-4xl mx-auto flex-grow px-0 lg:px-4 order-1 lg:order-2">
           
           <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">ç¨‹å¼ç¢¼ç‰‡æ®µå–ä»£å·¥å…·</h1>

           <!-- Input Section -->
           <div class="space-y-6 mb-8">
               <!-- Source Code Input -->
               <div>
                   <label for="sourceCode" class="block text-lg font-medium text-gray-700 mb-2">1. å®Œæ•´åŸå§‹ç¢¼ (è²¼ä¸Šå…¨éƒ¨å…§å®¹)</label>
                   <textarea id="sourceCode" rows="8" class="w-full resize-y p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 font-mono text-sm" placeholder="è«‹å°‡æ‚¨çš„å®Œæ•´ç¨‹å¼ç¢¼è²¼åœ¨æ­¤è™•..."></textarea>
               </div>

               <!-- Segment Input -->
               <div>
                   <label for="segmentToFind" class="block text-lg font-medium text-gray-700 mb-2">2. æ¬²å°‹æ‰¾ä¸¦å–ä»£çš„ç‰‡æ®µ (è²¼ä¸Š 'efg' çš„éƒ¨åˆ†)</label>
                   <textarea id="segmentToFind" rows="3" class="w-full resize-y p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 font-mono text-sm" placeholder="è«‹è²¼ä¸Šæ‚¨æƒ³å¾åŸå§‹ç¢¼ä¸­å°‹æ‰¾ä¸¦æ›¿æ›çš„ç¨‹å¼ç¢¼ç‰‡æ®µ..."></textarea>
               </div>

               <!-- Replacement Input -->
               <div>
                   <label for="replacementCode" class="block text-lg font-medium text-gray-700 mb-2">3. æ–°çš„å–ä»£å…§å®¹ (å–ä»£ 'efg' å¾Œçš„å…§å®¹)</label>
                   <textarea id="replacementCode" rows="3" class="w-full resize-y p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 font-mono text-sm" placeholder="è«‹è¼¸å…¥å°‡å–ä»£èˆŠç‰‡æ®µçš„æ–°ç¨‹å¼ç¢¼..."></textarea>
               </div>
           </div>

           <!-- Detection and Action Area -->
           <div class="bg-white p-6 rounded-xl shadow-lg border border-sky-100">
               <h2 class="text-xl font-semibold text-sky-700 mb-4">åµæ¸¬èˆ‡é è¦½çµæœ</h2>

               <div id="statusMessage" class="mb-4 text-center p-3 rounded-lg text-sm transition-all duration-300">
                   <!-- Status messages displayed here -->
               </div>

               <div class="mb-6">
                   <label class="block text-base font-medium text-gray-700 mb-2">åµæ¸¬çµæœé è¦½ (é«˜äº®éƒ¨åˆ†ç‚ºå³å°‡è¢«å–ä»£çš„ç‰‡æ®µï¼Œå°‡è‡ªå‹•æ»¾å‹•è‡³é¦–å€‹ç‰‡æ®µ):</label>
                   <pre id="previewCode" class="code-area bg-gray-50"></pre>
               </div>

               <button id="replaceButton" class="w-full py-3 px-4 bg-sky-600 text-white font-semibold rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-4 focus:ring-sky-300 disabled:bg-gray-400 transition duration-150" disabled>
                   ç¢ºèªä¸¦å®Œæ•´å–ä»£æ­¤ç‰‡æ®µ
               </button>
           </div>

           <!-- Confirmation Modal (Custom UI for confirmation) -->
           <div id="confirmationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50">
               <div class="bg-white rounded-xl p-6 shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100">
                   <h3 class="text-xl font-bold mb-4 text-red-600">âš  æœ€çµ‚ç¢ºèª</h3>
                   <p class="mb-6 text-gray-700">æ‚¨ç¢ºå®šè¦å°‡åŸå§‹ç¢¼ä¸­åµæ¸¬åˆ°çš„ **æ‰€æœ‰ç›¸ç¬¦ç‰‡æ®µ** å®Œæ•´æ›¿æ›ç‚ºæ–°çš„å…§å®¹å—ï¼Ÿæ­¤æ“ä½œå°‡è¦†è“‹åŸå§‹ç¢¼ï¼</p>
                   <div class="flex justify-end space-x-3">
                       <button id="cancelReplace" class="py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150">
                           å–æ¶ˆ
                       </button>
                       <button id="confirmReplace" class="py-2 px-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-150">
                           ç¢ºå®šå–ä»£
                       </button>
                   </div>
               </div>
           </div>

       </div>

       <!-- å»£å‘Šä½ 4 & 5: å³å´å †ç–Š (Right Stack) -->
       <!-- å¯¦éš›éƒ¨ç½²æ™‚ï¼Œè«‹å°‡æ­¤ div å…§çš„å…§å®¹æ›¿æ›ç‚ºæ‚¨çš„å»£å‘Šç¨‹å¼ç¢¼ -->
       <div class="flex lg:flex-col justify-center lg:space-y-4 space-x-4 lg:space-x-0 order-3 lg:w-[150px] mt-4 lg:mt-0">
           <div id="ad-right-1" class="ad-slot ad-skyscraper flex-1 lg:flex-none w-full">å»£å‘Šä½ 4 (120x250)</div>
           <div id="ad-right-2" class="ad-slot ad-skyscraper flex-1 lg:flex-none w-full">å»£å‘Šä½ 5 (120x250)</div>
       </div>
   </div>

   <!-- å»£å‘Šä½ 6: åº•éƒ¨æ©«å¹… (Bottom Banner) -->
   <!-- å¯¦éš›éƒ¨ç½²æ™‚ï¼Œè«‹å°‡æ­¤ div å…§çš„å…§å®¹æ›¿æ›ç‚ºæ‚¨çš„å»£å‘Šç¨‹å¼ç¢¼ -->
   <div id="ad-bottom-banner" class="ad-slot ad-banner max-w-7xl mx-auto mt-4">
       å»£å‘Šä½ 6 (728x90) - å¯æ›¿æ›
   </div>

   <script>
       // DOM å…ƒç´ ç²å–
       const sourceCodeEl = document.getElementById('sourceCode');
       const segmentToFindEl = document.getElementById('segmentToFind');
       const replacementCodeEl = document.getElementById('replacementCode');
       const previewCodeEl = document.getElementById('previewCode');
       const replaceButton = document.getElementById('replaceButton');
       const statusMessageEl = document.getElementById('statusMessage');
       const confirmationModal = document.getElementById('confirmationModal');
       const confirmReplaceButton = document.getElementById('confirmReplace');
       const cancelReplaceButton = document.getElementById('cancelReplace');

       // ç‹€æ…‹è®Šæ•¸
       let matchFound = false;

       /**
        * é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
        * @param {string} message - è¦é¡¯ç¤ºçš„æ–‡å­—
        * @param {string} type - è¨Šæ¯é¡å‹ ('success', 'error', 'info')
        */
       function showStatus(message, type) {
           statusMessageEl.textContent = message;
           statusMessageEl.className = 'mb-4 text-center p-3 rounded-lg text-sm transition-all duration-300'; // Reset classes

           switch (type) {
               case 'success':
                   statusMessageEl.classList.add('bg-green-100', 'text-green-800');
                   break;
               case 'error':
                   statusMessageEl.classList.add('bg-red-100', 'text-red-800');
                   break;
               case 'info':
               default:
                   statusMessageEl.classList.add('bg-blue-100', 'text-blue-800');
                   break;
           }
       }

       /**
        * æ ¸å¿ƒé‚è¼¯ï¼šåµæ¸¬ã€é«˜äº®ä¸¦æ›´æ–°é è¦½ (å«è‡ªå‹•æ»¾å‹•)
        */
       function detectAndPreview() {
           const source = sourceCodeEl.value;
           const segment = segmentToFindEl.value;
           const replacement = replacementCodeEl.value;
           matchFound = false;
           replaceButton.disabled = true;

           // æ¸…ç©ºé è¦½å’Œç‹€æ…‹
           previewCodeEl.innerHTML = '';

           if (source.length === 0 || segment.length === 0) {
               showStatus('è«‹åœ¨ä¸Šæ–¹è¼¸å…¥å®Œæ•´åŸå§‹ç¢¼å’Œæ¬²å°‹æ‰¾çš„ç‰‡æ®µã€‚', 'info');
               return;
           }

           // ä½¿ç”¨ RegExp é€²è¡Œå…¨åŸŸå°‹æ‰¾å’Œæ›¿æ›ï¼ŒåŒæ™‚è€ƒæ…®ç‰¹æ®Šå­—å…ƒè½‰ç¾©
           const escapedSegment = segment.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
           const regex = new RegExp(escapedSegment, 'g');
           
           // æª¢æŸ¥æ˜¯å¦æœ‰åŒ¹é…
           const matches = source.match(regex);
           
           if (!matches || matches.length === 0) {
               // æœªæ‰¾åˆ°åŒ¹é…
               previewCodeEl.textContent = source;
               showStatus('âŒ éŒ¯èª¤ï¼šæœªåœ¨åŸå§‹ç¢¼ä¸­æ‰¾åˆ°å®Œå…¨ç›¸ç¬¦çš„ç‰‡æ®µã€‚è«‹æª¢æŸ¥è¼¸å…¥å…§å®¹ã€‚', 'error');
               return;
           }

           // æ‰¾åˆ°åŒ¹é…ï¼Œæº–å‚™é«˜äº®é¡¯ç¤º
           matchFound = true;
           replaceButton.disabled = false;
           
           // å‰µå»ºé«˜äº® HTML å…§å®¹
           const highlightedHtml = source.replace(regex, (match) => {
               // ä½¿ç”¨ highlight span tag
               return `<span class="highlight">${match}</span>`;
           });
           
           // ç‚ºäº†ä¿æŒæ›è¡Œç¬¦è™Ÿå’Œç©ºæ ¼ï¼Œéœ€è¦ç”¨ innerHTML
           previewCodeEl.innerHTML = highlightedHtml;
           showStatus(`âœ… æˆåŠŸï¼šå·²åµæ¸¬åˆ° ${matches.length} å€‹ç›¸ç¬¦ç‰‡æ®µã€‚é è¦½å·²è‡ªå‹•è·³è½‰ã€‚`, 'success');

           // --- è‡ªå‹•æ»¾å‹•é‚è¼¯ï¼šç¢ºä¿é è¦½è·³è½‰åˆ°ç¬¬ä¸€å€‹åŒ¹é…è™• ---
           const firstHighlight = previewCodeEl.querySelector('.highlight');
           if (firstHighlight) {
               firstHighlight.scrollIntoView({
                   behavior: 'smooth', // å¹³æ»‘æ»¾å‹•
                   block: 'center'    // å°‡å…ƒç´ ç½®æ–¼å¯è¦‹å€åŸŸçš„ä¸­å¤®
               });
           }
           // -----------------------------------------------------
       }

       /**
        * åŸ·è¡Œæœ€çµ‚å–ä»£æ“ä½œ
        */
       function performReplacement() {
           const source = sourceCodeEl.value;
           const segment = segmentToFindEl.value;
           const replacement = replacementCodeEl.value;

           if (!matchFound) {
               showStatus('ğŸš« éŒ¯èª¤ï¼šåœ¨å–ä»£å‰å¿…é ˆå…ˆæˆåŠŸåµæ¸¬åˆ°ç›¸ç¬¦çš„ç‰‡æ®µï¼', 'error');
               return;
           }

           // ä½¿ç”¨ RegExp é€²è¡Œå…¨åŸŸå–ä»£
           const escapedSegment = segment.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
           const regex = new RegExp(escapedSegment, 'g');
           
           const newCode = source.replace(regex, replacement);

           // æ›´æ–°åŸå§‹ç¢¼å…§å®¹
           sourceCodeEl.value = newCode;

           // æ¸…ç©ºå¾…å–ä»£ç‰‡æ®µï¼Œä¸¦é‡æ–°è§¸ç™¼åµæ¸¬ä»¥é¡¯ç¤ºæ–°ç¨‹å¼ç¢¼
           segmentToFindEl.value = '';
           replacementCodeEl.value = '';
           detectAndPreview();

           // æœ€çµ‚ç‹€æ…‹æç¤º
           showStatus('ğŸ‰ å®Œæˆï¼šæ‰€æœ‰ç‰‡æ®µå·²æˆåŠŸæ›¿æ›ï¼åŸå§‹ç¢¼å·²æ›´æ–°ã€‚', 'success');
       }

       // --- Event Listeners ---

       // ç›£è½æ‰€æœ‰è¼¸å…¥æ¡†çš„è¼¸å…¥äº‹ä»¶
       sourceCodeEl.addEventListener('input', detectAndPreview);
       segmentToFindEl.addEventListener('input', detectAndPreview);
       replacementCodeEl.addEventListener('input', detectAndPreview);

       // åˆå§‹åŒ–æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡åµæ¸¬
       document.addEventListener('DOMContentLoaded', detectAndPreview);

       // é»æ“Šå–ä»£æŒ‰éˆ•ï¼Œé¡¯ç¤ºç¢ºèªè¦–çª—
       replaceButton.addEventListener('click', () => {
           if (matchFound) {
               confirmationModal.classList.remove('hidden');
           }
       });

       // ç¢ºèªå–ä»£æŒ‰éˆ•
       confirmReplaceButton.addEventListener('click', () => {
           confirmationModal.classList.add('hidden');
           performReplacement();
       });

       // å–æ¶ˆå–ä»£æŒ‰éˆ•
       cancelReplaceButton.addEventListener('click', () => {
           confirmationModal.classList.add('hidden');
       });
       
       // é»æ“ŠèƒŒæ™¯é—œé–‰ç¢ºèªè¦–çª—
       confirmationModal.addEventListener('click', (e) => {
           if (e.target === confirmationModal) {
               confirmationModal.classList.add('hidden');
           }
       });

       // ç¢ºä¿åˆå§‹ç‹€æ…‹é¡¯ç¤º
       showStatus('è«‹åœ¨ä¸Šæ–¹è¼¸å…¥å®Œæ•´åŸå§‹ç¢¼å’Œæ¬²å°‹æ‰¾çš„ç‰‡æ®µã€‚', 'info');

   </script>
</body>
</html>